---
import Header from '../components/Header.astro';
import Sidebar from '../components/Sidebar.astro';
import {
  about,
  certifications,
  contact,
  education,
  experience,
  hero,
  languages,
  projects,
  site,
  skills,
} from '../data/portfolio';

const hasExternalUrl = (url: string) => /^https?:\/\//i.test(url.trim());
const base = import.meta.env.BASE_URL.replace(/\/?$/, '/');
const resolveAsset = (path: string) => `${base}${path.replace(/^\//, '')}`;
---

<!DOCTYPE html>
<html lang="en">
  <Header title={site.title} description={site.description} canonicalUrl={site.canonicalUrl} ogImage={site.ogImage} />
  <body>
    <div class="content">
      <Sidebar />
      <main class="main">
        <div class="theme-toggle-wrap">
          <button id="themeToggle" class="theme-toggle button w-button" type="button" aria-label="Toggle light mode">
            Light mode
          </button>
        </div>
        <div class="container portfolio-container">
          <section id="home" class="portfolio-section hero-section">
            <div class="fold-content">
              <div class="mini-label-white">{site.location}</div>
              <h1>{hero.greeting}<br />{hero.headline}</h1>
              <p class="lead">{hero.oneLiner}</p>
              <div class="chips-container role-chips">
                {hero.keyRoles.map((role) => <div class="single-chip small-chip">{role}</div>)}
              </div>
            </div>
            <div class="cta-row">
              <a href={hero.ctas.email} class="button w-button"><img src={resolveAsset('/assets/browser.svg')} alt="" class="button-icon" />Email</a>
              <a href={hero.ctas.linkedin} target="_blank" rel="noreferrer" class="button w-button"><img src={resolveAsset('/assets/dns.svg')} alt="" class="button-icon" />LinkedIn</a>
              <a href={hero.ctas.github} target="_blank" rel="noreferrer" class="button w-button"><img src={resolveAsset('/assets/code.svg')} alt="" class="button-icon" />GitHub</a>
              <a href={hero.ctas.cv} class="button w-button" download><img src={resolveAsset('/assets/favorite.svg')} alt="" class="button-icon" />Download CV</a>
            </div>
          </section>

          <section id="about" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/code.svg')} alt="" class="section-icon" /><h3>About</h3></div>
            <div class="project-desc project-desc-list w-richtext">
              <ul role="list">
                {about.map((line) => <li>{line}</li>)}
              </ul>
            </div>
          </section>

          <section id="skills" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/browser.svg')} alt="" class="section-icon" /><h3>Skills</h3></div>
            <div class="skills-grid">
              {skills.map((group) => (
                <article class="skill-card">
                  <div class="mini-label-white gray-color">{group.group}</div>
                  <div class="chips-container">
                    {group.items.map((skill) => (
                      <div class="single-chip">
                        {skill.name} <span class="skill-level">{skill.level}</span>
                      </div>
                    ))}
                  </div>
                </article>
              ))}
            </div>
          </section>

          <section id="experience" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/dns.svg')} alt="" class="section-icon" /><h3>Experience</h3></div>
            <div class="resouce-items">
              {experience.map((role) => (
                <article class="single-item">
                  <h4>{role.title}</h4>
                  <p class="meta-line">{role.company} | {role.location} | {role.dates}</p>
                  <div class="project-desc project-desc-list w-richtext">
                    <ul role="list">
                      {role.bullets.map((bullet) => <li>{bullet}</li>)}
                    </ul>
                  </div>
                </article>
              ))}
            </div>
          </section>

          <section id="projects" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/favorite.svg')} alt="" class="section-icon" /><h3>Featured Projects</h3></div>
            <div class="resouce-items">
              {projects.map((project) => (
                <article class="single-item project-card">
                  <div class="project-header">
                    <h4>{project.name}</h4>
                    <div class="project-visual-wrap">
                      <img src={resolveAsset(project.visual.icon)} alt={project.visual.alt} class="project-visual-icon" />
                    </div>
                  </div>
                  <p><strong>Problem:</strong> {project.problem}</p>
                  <p><strong>Approach:</strong> {project.approach}</p>
                  <p><strong>Impact:</strong> {project.impact}</p>
                  <div class="mini-label-white gray-color">Highlights</div>
                  <div class="project-desc project-desc-list w-richtext">
                    <ul role="list">
                      {project.highlights.map((highlight) => <li>{highlight}</li>)}
                    </ul>
                  </div>
                  <div class="mini-label-white gray-color">Tech Stack</div>
                  <div class="chips-container">
                    {project.tech.map((item) => <div class="single-chip small-chip">{item}</div>)}
                  </div>
                  <div class="project-links">
                    {hasExternalUrl(project.links.repo) && (
                      <a href={project.links.repo} class="button w-button" target="_blank" rel="noreferrer">Repo</a>
                    )}
                    {hasExternalUrl(project.links.demo) && (
                      <a href={project.links.demo} class="button w-button" target="_blank" rel="noreferrer">Demo</a>
                    )}
                  </div>
                </article>
              ))}
            </div>
          </section>

          <section id="education" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/database.svg')} alt="" class="section-icon" /><h3>Education</h3></div>
            <div class="resouce-items">
              {education.map((item) => (
                <article class="single-item">
                  <h4>{item.degree}</h4>
                  <p class="meta-line">{item.school} | {item.location} | {item.dates}</p>
                  {item.grade && <p class="meta-line">{item.grade}</p>}
                  <div class="mini-label-white gray-color">Relevant Modules</div>
                  <div class="chips-container">
                    {item.modules.map((module) => <div class="single-chip small-chip">{module}</div>)}
                  </div>
                </article>
              ))}
            </div>
          </section>

          <section id="certifications" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/home.svg')} alt="" class="section-icon" /><h3>Certifications & Languages</h3></div>
            <div class="cert-grid">
              <article class="single-item">
                <div class="mini-label-white gray-color">Certifications</div>
                <div class="project-desc project-desc-list w-richtext">
                  <ul role="list">
                    {certifications.map((certification) => <li>{certification}</li>)}
                  </ul>
                </div>
              </article>
              <article class="single-item">
                <div class="mini-label-white gray-color">Languages</div>
                <div class="project-desc project-desc-list w-richtext">
                  <ul role="list">
                    {languages.map((language) => <li>{language}</li>)}
                  </ul>
                </div>
              </article>
            </div>
          </section>

          <section id="contact" class="portfolio-section">
            <div class="section-title"><img src={resolveAsset('/assets/browser.svg')} alt="" class="section-icon" /><h3>Contact</h3></div>
            <p class="lead">Open to Data Engineer, ML Engineer, and Cloud/Platform roles across London and the UK.</p>
            <div class="cta-row">
              <a class="button w-button" href={`mailto:${contact.email}`}><img src={resolveAsset('/assets/browser.svg')} alt="" class="button-icon" />Email</a>
              <a class="button w-button" href={contact.linkedin} target="_blank" rel="noreferrer"><img src={resolveAsset('/assets/dns.svg')} alt="" class="button-icon" />LinkedIn</a>
              <a class="button w-button" href={contact.github} target="_blank" rel="noreferrer"><img src={resolveAsset('/assets/code.svg')} alt="" class="button-icon" />GitHub</a>
            </div>
          </section>
        </div>
      </main>
    </div>
    <script>
      const THEME_KEY = 'portfolio-theme';
      const toggle = document.getElementById('themeToggle');

      const setTheme = (theme) => {
        document.documentElement.setAttribute('data-theme', theme);
        if (toggle) {
          toggle.textContent = theme === 'light' ? 'Dark mode' : 'Light mode';
          toggle.setAttribute('aria-pressed', String(theme === 'light'));
        }
      };

      const storedTheme = localStorage.getItem(THEME_KEY);
      const initialTheme =
        storedTheme ||
        (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

      setTheme(initialTheme);

      if (toggle) {
        toggle.addEventListener('click', () => {
          const current = document.documentElement.getAttribute('data-theme') || 'dark';
          const next = current === 'light' ? 'dark' : 'light';
          localStorage.setItem(THEME_KEY, next);
          setTheme(next);
        });
      }
    </script>
  </body>
</html>
